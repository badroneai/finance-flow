# تقرير التقسيم النهائي — App.jsx

## 1. أحجام App.jsx

| المرحلة | عدد الأسطر |
|---------|------------|
| **قبل التقسيم** | **4 046** |
| **بعد التقسيم (النهائي)** | **383** |

نسبة الانخفاض: ~90.5%.

---

## 2. الملفات الجديدة المُنشأة (خلال خطوات التقسيم)

| الملف | عدد الأسطر |
|-------|------------|
| **الصفحات (src/pages/)** | |
| HomePage.jsx | 51 |
| DashboardPage.jsx | 84 |
| TemplatesPage.jsx | 25 |
| TransactionsPage.jsx | 247 |
| CommissionsPage.jsx | 272 |
| GeneratorPage.jsx | 126 |
| DraftsPage.jsx | 57 |
| NotesCalendar.jsx | 470 |
| SettingsPage.jsx | 361 |
| LedgersPage.jsx | 1 286 |
| **واجهة المستخدم (الخطوة 9)** | |
| HelpPanel.jsx | 128 |
| OnboardingModal.jsx | 61 |

ملاحظة: مكونات وملفات أخرى (مثل Sidebar، Modals، TrustChecks، WelcomeBanner، ErrorBoundaries، التبويبات في `tabs/`، إلخ) كانت موجودة مسبقًا أو أُنشئت في مراحل سابقة وليست جزءًا من خطوة التقسيم الأخيرة.

---

## 3. مراجعة App.jsx النهائية

### 3.1 عدد الأسطر
- **383 سطرًا** (بعد الخطوة 9).

### 3.2 هل بقي أي مكون أو دالة يمكن نقلها؟
- **لا.** المحتوى المتبقي في App.jsx هو:
  - **استيرادات** لصفحات، واجهة، نطاقات، وتخزين (مطلوبة للتوجيه وللصفحات التي تحتاج بيانات مشتركة أو أحداث).
  - **NAV_ITEMS** (ربط ثوابت التنقل بأيقونات من Icons).
  - **المكون App** مع حالة التوجيه والـ UI العام (Sidebar، Topbar، WelcomeBanner، OnboardingModal، HelpPanel، renderPage، Footer).
  - **renderPage** (switch يعيد الصفحة حسب `page`).
  - **تصدير** المكون الافتراضي.

لا يُفترض نقل أي من هذا إلى ملفات أخرى لأن دوره هو الربط والتوجيه فقط.

### 3.3 قائمة المكونات/الدوال المتبقية في App.jsx وسبب بقائها

| العنصر | السبب |
|--------|--------|
| **NAV_ITEMS** | يُبنى مرة واحدة من NAV_ITEMS_BASE + Icons ويُمرَّر إلى Sidebar؛ مناسب أن يبقى بجانب نقطة الدخول. |
| **المكون App** | نقطة الدخول الرئيسية؛ تحتوي على state التوجيه (page، collapsed، mobileOpen، إلخ) والهيكل العام (ToastProvider، UnsavedContext، Sidebar، Topbar، main، footer). |
| **renderPage** | توزيع الصفحات حسب `page`؛ منطق التوجيه المركزي. |
| **حالة showOnboarding / showHelp / helpSection** | تُدار في App لأنها تتفاعل مع التنقل (مثل فتح الإعدادات من المساعدة أو من الترحيب). |
| **Escape لإغلاق المساعدة + حدث ui:help** | معالجات عامة على مستوى التطبيق؛ تبقى في App. |
| **updateHeaderDate / scheduleHeaderDateMidnightRefresh** | تحديث تاريخ الهيدر وربطه بحدثي ui:numerals و ui:dateHeader؛ يبقى في App. |
| **تأثير initTheme / initNumerals / عرض Onboarding عند أول تحميل** | تهيئة واجهة وتجربة أول استخدام؛ تبقى في App. |
| **تأثير beforeunload عند dirty** | تحذير المغادرة عند وجود تغييرات غير محفوظة؛ يبقى في App. |
| **SIMULATE_RENDER_ERROR** | للاختبار فقط؛ يمكن إزالته لاحقًا أو تركه. |
| **استيرادات core/domain/constants/utils** | تُستخدم في renderPage أو في معالجات App (مثل SettingsPage، storage، theme، إلخ). |

---

## 4. هيكل المجلدات بعد التقسيم (مختصر)

```
src/
├── App.jsx
├── main.jsx
├── contexts/
│   ├── ToastContext.jsx
│   └── UnsavedContext.jsx
├── core/           # (ملفات js موجودة مسبقًا)
├── domain/        # (ملفات js موجودة مسبقًا)
├── pages/
│   ├── HomePage.jsx
│   ├── DashboardPage.jsx
│   ├── TemplatesPage.jsx
│   ├── TransactionsPage.jsx
│   ├── CommissionsPage.jsx
│   ├── GeneratorPage.jsx
│   ├── DraftsPage.jsx
│   ├── NotesCalendar.jsx
│   ├── SettingsPage.jsx
│   └── LedgersPage.jsx
├── tabs/
│   ├── LedgerRecurringTab.jsx
│   ├── LedgerPerformanceTab.jsx
│   ├── LedgerReportsTab.jsx
│   └── ...
├── ui/
│   ├── Sidebar.jsx
│   ├── Modals.jsx
│   ├── HelpPanel.jsx      ← جديد (الخطوة 9)
│   ├── OnboardingModal.jsx ← جديد (الخطوة 9)
│   ├── WelcomeBanner.jsx
│   ├── TrustChecks.jsx
│   ├── ErrorBoundaries.jsx
│   ├── ui-common.jsx
│   └── ledger/
│       ├── LedgerHeader.jsx
│       └── LedgerTabsShell.jsx
├── utils/
│   ├── format.jsx
│   ├── dateFormat.js
│   └── ...
└── constants/
    └── index.js
```

---

## 5. التحقق

- **`npm run build`**: نجح.
- **`npm run dev`**: يُفترض تشغيله يدويًا والتحقق من:
  - ظهور الصفحة الرئيسية،
  - التنقل بين كل الصفحات،
  - عمل الثيم (فاتح/غامق)،
  - عمل الأرقام العربية/الإنجليزية.

---

## 6. ملاحظات وتوصيات للتحسين المستقبلي

1. **تنظيف الاستيرادات في App.jsx**  
   إزالة أي استيراد غير مستخدم في App بعد التقسيم (مثل رموز من domain أو core لا تُستدعى إلا داخل الصفحات).

2. **LedgerTabErrorBoundary**  
   مُستورد في App لكنه يُستخدم داخل LedgersPage؛ يمكن نقله إلى استيراد LedgersPage فقط إن رُغب في تقليل تبعيات App.

3. **ثابت SIMULATE_RENDER_ERROR**  
   للاختبار فقط؛ يمكن حذفه أو نقله إلى بيئة تطوير.

4. **تجميع منطق الهيدر (التاريخ)**  
   يمكن لاحقًا استخراج منطق `headerDateText` و`updateHeaderDate` و`scheduleHeaderDateMidnightRefresh` إلى مكون أو hook إذا نما استخدامه.

5. **NAV_ITEMS**  
   يمكن نقله إلى ملف ثوابت أو إلى Sidebar إذا أردت فصلًا أوضح بين التنقل والـ App.

6. **الخطوة 9**  
   تم استخراج محتوى المساعدة إلى `HelpPanel.jsx` ومحتوى الترحيب إلى `OnboardingModal.jsx` مع الحفاظ على نفس السلوك (إغلاق، فتح الإعدادات، التمرير عند الطلب).
