# تقرير الخطوة 10: إصلاح رسم لوحة التحكم + تنظيف

## 1. إصلاح bug الرسم البياني (DashboardPage)

**الملف:** `src/pages/DashboardPage.jsx`

**المشكلة:** `useMemo` لـ `chartData` كان بتبعيات فارغة `[]` فلم يكن الرسم يتحدث عند إضافة حركات جديدة أو تغيير الفترة.

**الحل:**
- جلب قائمة الحركات قبل `useMemo`: `const allTxsForChart = dataStore.transactions.list({});`
- جعل تبعيات `useMemo`: `[periodType, fromDate, toDate, allTxsForChart.length]`
- عند تغيير الفترة أو عدد الحركات (مثلاً بعد العودة من صفحة الحركات)، يُعاد حساب الرسم.

---

## 2. الملفات المحذوفة

| الملف | السبب |
|-------|--------|
| `assets/js/bootstrap.js` | غير مستورد في أي مكان في `src/`. كان يعيد التصدير فقط من `public/assets/js/core/formatters.js` ولا يُستخدم في تطبيق Vite/React. |

**ملاحظة:** لم يُحذف أي ملف من `public/assets/` أو `assets/` (مثل keys.js، storage.js) لأنها مستخدمة في الاستيرادات أو في الصفحات الثابتة (HTML).

**ملف format.js:** لا يوجد ملف `src/utils/format.js` في المشروع (يوجد فقط `format.jsx`) — لا إجراء.

---

## 3. Dead code والاستيرادات المُزالة (App.jsx)

### استيرادات مُزالة من App.jsx (غير مستخدمة بعد استخراج الصفحات):

- **React:** `useMemo`, `useRef`, `useContext`
- **UI:** `Modal`, `ConfirmDialog`, `Icon`, `FormField`, `SettingsField`, `SummaryCard`, `EmptyState`, `EnhancedEmptyState`, `Badge`, `LedgerTabErrorBoundary`, `useToast`
- **Utils:** `downloadCSV`
- **Core/Storage:** `STORAGE_KEYS`, `storage`, `getLedgers`, `setLedgers`, `getActiveLedgerId`, `setActiveLedgerId`, `getRecurringItems`, `setRecurringItems`, `seedRecurringForLedger`
- **Core (ledger/recurring/domain):** كل استيرادات recurring-intelligence، ledger-budgets، ledger-intelligence-v1، exports-map (ledgerBrain/ledgerForecast/ledgerVariance)، ledger-inbox، ledger-cash-plan، ledger-item-history، ledger-budget-authority، ledger-compliance، ledger-reports، getTemplateForLedgerType، domain/index (filterTransactions، sumTransactions، إلخ)، checkStorageQuota
- **Constants:** `KEYS`, `MSG`, `TRANSACTION_TYPES`, `TRANSACTION_CATEGORIES`, `PAYMENT_METHODS`, `COMMISSION_STATUSES`, `LETTER_TYPES`, `DASHBOARD_PERIOD_OPTIONS`, `SEED_SETTINGS`, `STORAGE_ERROR_MESSAGE` (بقي `NAV_ITEMS_BASE` فقط)
- **Utils:** `genId`, `now`, `today`, `isValidDateStr`, `safeNum`, `formatNumber`, `formatCurrency`, `formatPercent`, `formatNum`, `SarSymbol`, `Currency`, `formatDateGregorianNumeric`, `formatDateHijriNumeric`
- **theme-ui:** `getSavedTheme`, `getSavedNumerals`, `setDateHeaderPref`, `applyTheme`, `applyNumerals`, `UI_THEME_KEY`, `UI_NUMERALS_KEY`, `UI_DATE_HEADER_KEY`
- **dataStore:** `safeGet`, `detectPrivateBrowsing`

### دوال/متغيرات:
- لم تُحذف أي دوال معرّفة داخل App — بقي فقط ما يخص التوجيه والهيكل العام.

---

## 4. SIMULATE_RENDER_ERROR

**الملف:** `src/App.jsx`

- القيمة: `false` (بدون تغيير).
- تم توضيح التعليق: «للتطوير فقط: ضع true لاختبار شاشة استعادة الأخطاء (Error Boundary) ثم أعد false قبل النشر.»

---

## 5. الاستيرادات المصححة / المتبقية في App.jsx

- بقي في App: `React` (useState, useEffect, useCallback), `Sidebar`, `Topbar`, `ToastProvider`, `UnsavedContext`, `TrustChecks`, `WelcomeBanner`, `HelpPanel`, `OnboardingModal`, `Icons`, صفحات التطبيق، `storageFacade`, `NAV_ITEMS_BASE`, `getSavedDateHeader`, `getOnboardingSeen`, `setOnboardingSeen`, `initTheme`, `initNumerals`, `UI_ONBOARDING_SEEN_KEY`, `dataStore`, `formatDateHeader`.

---

## 6. نتيجة البناء

```
npm run build — ✓ نجح
```

---

## ملخص

| البند | الإجراء |
|-------|---------|
| Bug الرسم | تصحيح تبعيات `useMemo` في DashboardPage |
| ملف محذوف | `assets/js/bootstrap.js` |
| format.js | غير موجود — لا إجراء |
| Dead code | إزالة استيرادات غير مستخدمة من App.jsx |
| SIMULATE_RENDER_ERROR | تعليق واضح + القيمة false |
| البناء | نجح |
